# 4.1 课程内容简介

今天的主题是虚拟内存（Virtual Memory）。具体来说，==我们会介绍页表（page tables）==。在后面的课程中，我们还会介绍虚拟内存相关的其他内容。

首先，我们会从一些问答开始今天的课程。

我想问你们还记得课程6.004和课程6.033中虚拟内存的内容吗？我先来说一下我自己对于虚拟内存或者页表的认知吧。

当我还是个学生并第一次听到学到这个词时，我认为它还是很直观简单的。这能有多难呢？无非就是个表单，将虚拟地址和物理地址映射起来，实际可能稍微复杂一点，但是应该不会太难。**可是当我开始通过代码管理虚拟内存，我才知道虚拟内存比较棘手，比较有趣，功能也很强大。**所以，希望在接下来的几节课和几个实验中，你们也能同样的理解虚拟内存。接下来我会问几个同学你们对于虚拟内存的理解是什么。

### 学生提问

> 学生1：这就是用来存放虚拟内存到物理内存映射关系的。
>
> 学生2：这是用来保护硬件设备的。在6.004中介绍的，虚拟地址是12bit，最终会映射到某些16bit的物理地址。
>
> 学生3：通过虚拟内存，每个进程都可以有独立的地址空间。通过地址管理单元（Memory Management Unit）或者其他的技术，可以将每个进程的虚拟地址空间映射到物理内存地址。虚拟地址的低bit基本一样，所以映射是以块为单位进行，同时性能也很好。
>
> 学生4：虚拟地址可以让我们对进程隐藏物理地址。通过一些聪明的操控，我们可以读写虚拟地址，最后实际读写物理地址。
>
> 学生5：虚拟内存对于隔离性来说是非常基础的。每个进程都可以认为自己有独立的内存可以使用。

刚刚的回答中，很明显有两件事情是对的。==这里存在某种形式的映射关系；并且映射关系对于实现隔离性来说有帮助。==

隔离性是我们讨论虚拟内存的主要原因。在接下来的两节课，尤其当我们开始通过代码管理虚拟内存之后，我们可以真正理解它的作用。这节课我们会主要关注虚拟内存的工作机制，之后我们会看到如何使用这里的机制来实现非常酷的功能。

今天的内容主要是3个部分：

1. 首先我会讨论一下**地址空间（Address Spaces）**。这个在刚刚的问答中有的同学也提到了。
2. 接下来，我会谈一下**支持虚拟内存的硬件**。当然，我介绍的是RISC-V相关的硬件。但是从根本上来说，所有的现代处理器都有某种形式的硬件，来作为实现虚拟内存的默认机制。
3. 最后，我们会过一下**XV6中的虚拟内存代码，并看一下内核地址空间和用户地址空间的结构**。

![](<../.gitbook/assets/image (358).png>)

以上就是这节课的主要内容。





# 4.1 虚拟内存课程内容简介详细总结

## 一、虚拟内存的概述与初步理解

### 1. 虚拟内存的初识

- 虚拟内存**将虚拟地址映射到物理地址**。

- 在6.004和6.033课程中介绍了虚拟内存基础。初看它似乎简单，但通过

  代码管理虚拟内存

  后会发现：

  - **实现复杂性高**：虚拟内存既有挑战性也有趣味性。
  - **功能强大**：它不仅实现了映射，还具有隔离性和保护机制。

### 2. 学生对虚拟内存的理解

- **学生1**：虚拟内存存储虚拟地址与物理地址的映射关系。
- **学生2**：虚拟内存用于保护硬件设备。虚拟地址（如12位）映射为更大的物理地址（如16位）。
- **学生3**：每个进程可以有**独立地址空间**，通过MMU（Memory Management Unit）将虚拟地址映射到物理地址。映射以**块**为单位实现，提升性能。
- **学生4**：虚拟地址**隐藏物理地址**，通过虚拟地址的操作，实际完成对物理地址的读写。
- **学生5**：虚拟内存实现了**隔离性**，使每个进程认为它拥有独立的内存。

> **总结**：上述学生的回答中有两个核心要点：
>
> 1. **映射关系**：虚拟地址映射到物理地址。
> 2. **隔离性**：通过虚拟内存隔离各个进程，保证独立的运行环境。

## 二、课程主题与学习目标

- **隔离性**是讨论虚拟内存的主要原因。在接下来的课程和实验中，通过代码实际操作虚拟内存，可以理解它的真正作用。

> **课程目标**：不仅学习虚拟内存的**工作机制**，还通过代码实现一些有趣的功能。

## 三、课程内容结构

### 1. 地址空间（Address Spaces）

- 每个进程都有**独立的地址空间**，避免不同进程之间相互干扰。

### 2. 硬件支持虚拟内存

- 课程以**RISC-V**处理器为例介绍支持虚拟内存的硬件。
- **现代处理器**通常都配备MMU等硬件，作为虚拟内存的实现机制。

### 3. XV6中的虚拟内存代码分析

- 通过代码查看XV6的**内核地址空间和用户地址空间**的结构，理解它们的布局与关系。

## 四、总结

- 本节课为虚拟内存的深入学习和实验打下基础。课程将介绍虚拟内存的**理论、硬件实现以及代码管理**，帮助学生掌握虚拟内存的核心知识。
- **学习路径**：从地址空间的概念出发，深入硬件支持机制，最后通过分析XV6的代码，全面理解虚拟内存在操作系统中的实现。

------

通过本次讲解，我们清晰地了解了虚拟内存的基本结构、隔离性的重要性以及如何通过代码实现这些概念。接下来的课程和实验将进一步探索这些机制的实现细节。

