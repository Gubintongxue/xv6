# 5.2 RISC-V vs x86

你们将会注意到，我们在这节课中反复会提到了RISC-V汇编。这一点很重要，因为汇编语言有很多种（注，因为不同的处理器指令集不一样，而汇编语言中都是一条条指令，所以不同处理器对应的汇编语言必然不一样）。如果你使用RISC-V，你不太能将Linux运行在上面。相应的，大多数现代计算机都运行在x86和x86-64处理器上。x86拥有一套不同的指令集，看起来与RISC-V非常相似。通常你们的个人电脑上运行的处理器是x86，Intel和AMD的CPU都实现了x86。

![](<../.gitbook/assets/image (841).png>)

RISC-V和x86并没有它们第一眼看起来那么相似。RISC-V中的RISC是精简指令集（Reduced Instruction Set Computer）的意思，而x86通常被称为CISC，复杂指令集（Complex Instruction Set Computer）。这两者之间有一些关键的区别：

* ==首先是指令的数量。==实际上，创造RISC-V的一个非常大的初衷就是因为Intel手册中指令数量太多了。x86-64指令介绍由3个文档组成，并且新的指令以每个月3条的速度在增加。因为x86-64是在1970年代发布的，所以我认为现在有多于15000条指令。RISC-V指令介绍由两个文档组成。在这节课中，不需要你们记住每一个RISC-V指令，但是如果你感兴趣或者你发现你不能理解某个具体的指令的话，在课程网站的参考页面有RISC-V指令的两个文档链接。这两个文档包含了RISC-V的指令集的所有信息，分别是240页和135页，相比x86的指令集文档要小得多的多。这是有关RISC-V比较好的一个方面。所以在RISC-V中，我们有更少的指令数量。
* ==除此之外，RISC-V指令也更加简单。==在x86-64中，很多指令都做了不止一件事情。这些指令中的每一条都执行了一系列复杂的操作并返回结果。但是RISC-V不会这样做，RISC-V的指令趋向于完成更简单的工作，相应的也消耗更少的CPU执行时间。这其实是设计人员的在底层设计时的取舍。并没有一些非常确定的原因说RISC比CISC更好。它们各自有各自的使用场景。
* ==相比x86来说，RISC另一件有意思的事情是它是开源的。==这是市场上唯一的一款开源指令集，这意味着任何人都可以为RISC-V开发主板。RISC-V是来自于UC-Berkly的一个研究项目，之后被大量的公司选中并做了支持，网上有这些公司的名单，许多大公司对于支持一个开源指令集都感兴趣。

我记得最近，作为主要的RISC-V处理器生产商，SiFive宣称会发布一款基于RISC-V的主板，用来在个人计算机上运行Linux系统。如果你好奇或者想要使用RISC-V，在你学完了6.S081之后，大概率你可以在你的个人电脑上通过RISC-V处理器运行Linux。

在你们的日常生活中，你们可能已经在完全不知情的情况下使用了精简指令集。**比如说ARM也是一个精简指令集，高通的Snapdragon处理器就是基于ARM。如果你使用一个Android手机，那么大概率你的手机运行在精简指令集上。**如果你使用IOS，苹果公司也实现某种版本的ARM处理器，这些处理器运行在iPad，iPhone和大多数苹果移动设备上，甚至对于Mac，苹果公司也在尝试向ARM做迁移（注，刚刚发布的Macbook）。所以精简指令集出现在各种各样的地方。如果你想在现实世界中找到RISC-V处理器，你可以在一些嵌入式设备中找到。所以RISC-V也是有应用的，当然它可能没有x86那么流行。

![](<../.gitbook/assets/image (858).png>)

在最近几年，由于Intel的指令集是在是太大了，精简指令集的使用越来越多。Intel的指令集之所以这么大，是因为Intel对于向后兼容非常看重。所以一个现代的Intel处理器还可以运行30/40年前的指令。Intel并没有下线任何指令。而RISC-V提出的更晚，所以不存在历史包袱的问题。

> 学生提问：为什么x86会有15000条指令？
>
> TA：如我刚刚说的，我们需要许多指令来实现向后兼容，向后兼容是否重要因人而异。另一方面，我认为这里许多指令都是cmd指令，用来完成一些特殊的操作。我从来没有见过一个Intel的汇编代码使用了所有的15000个指令。大多数这些指令都是为了向后兼容和cmd的需求创建。

如果查看RISC-V的文档，可以发现RISC-V的特殊之处在于：它区分了Base Integer Instruction Set和Standard Extension Instruction Set。Base Integer Instruction Set包含了所有的常用指令，比如add，mult。除此之外，处理器还可以选择性的支持Standard Extension Instruction Set。例如，一个处理器可以选择支持Standard Extension for Single-Precision Float-Point。这种模式使得RISC-V更容易支持向后兼容。 每一个RISC-V处理器可以声明支持了哪些扩展指令集，然后编译器可以根据支持的指令集来编译代码。

> 学生提问：看起来使用x86而不是RISC-V的唯一优势就是能得到性能的提升，但是这里的性能是以复杂度和潜在的安全为代价的，我的问题是为什么我们还在使用x86，而不是使用RISC-V处理器？
>
> TA：我并没有一个很好的答案来回答。现在整个世界都运行在x86上，如果你突然将处理器转变成RISC-V，那么你就会失去很多重要的软件支持。同时，Intel在它的处理器里面做了一些有意思的事情，例如安全相关的enclave，这是Intel最近加到处理器中来提升安全性的功能。此外，Intel还实现了一些非常具体的指令，这些指令可以非常高效的进行一些特定的运算。所以Intel有非常多的指令，通常来说对于一个场景都会有一个完美的指令，它的执行效率要高于RISC-V中的同等指令。但是这个问题更实际的答案是，RISC-V相对来说更新一些，目前还没有人基于RISC-V来制造个人计算机，SiFive也就是最近才成为第一批将RISC-V应用到个人计算机的公司。所以，从实际的角度来说，因为不能在RISC-V上运行所有为Intel设计的软件，是我对这个问题的最好的答案。





# 5.2 RISC-V 与 x86 的对比详细总结

## 一、RISC-V 与 x86 的概述

- **汇编语言**：每种处理器对应独特的汇编语言，基于其指令集架构（ISA）。
- **RISC-V** 和 **x86** 使用不同的ISA，因此它们的汇编语言也不同。

- **x86 和 x86-64**：Intel和AMD CPU实现的架构，大部分个人电脑运行于此。
- **RISC-V**：一种新兴的开源精简指令集，在嵌入式设备和部分研究项目中应用。

------

## 二、RISC（精简指令集）与 CISC（复杂指令集）的关键区别

1. **指令数量**
   - x86：有超过15,000条指令，并不断增加。
     - **原因**：向后兼容和应对特定的硬件需求。
   - RISC-V：指令集更小，主要由两部分组成：
     1. **Base Integer Instruction Set**：包括基础运算指令，如 `add` 和 `mult`。
     2. **Standard Extension Instruction Set**：处理器可以选择支持的扩展指令集（如单精度浮点运算）。
2. **指令的复杂性**
   - **x86**：一条指令可以完成多个操作，但会消耗更多的执行时间。
   - **RISC-V**：每条指令执行简单的任务，因此执行效率较高。
3. **开放性**
   - **RISC-V**：开源，任何人都可以开发和扩展。
   - **x86**：由Intel和AMD控制，封闭且专有。
4. **历史包袱**
   - **x86**：1970年代发布，为了支持旧软件，Intel从未淘汰过任何指令。
   - **RISC-V**：设计较新，没有历史兼容问题，结构更简洁。

## 三、RISC-V 的应用现状与发展

1. **RISC-V 在嵌入式设备中的应用**
   - **RISC-V** 已广泛用于**嵌入式系统**，但尚未大规模进入个人计算机市场。
   - 一些**嵌入式设备**和工业应用已经开始采用RISC-V处理器。
2. **RISC-V 在移动设备中的类比**
   - **ARM** 是另一种精简指令集，目前在**移动设备**（如Android和iPhone）上广泛应用。
   - 苹果公司正在将Mac设备迁移到基于**ARM**的架构。
3. **未来的潜力**
   - **SiFive**：一家公司计划推出**基于RISC-V的主板**，支持Linux操作系统。

## 四、RISC-V 与 x86 的挑战与机遇

1. **向后兼容的挑战**
   - **x86的优势**：可以运行30至40年前的软件，这对大多数企业和用户来说非常重要。
   - **RISC-V的劣势**：当前无法运行为Intel设计的大量软件，导致市场接受度较低。
2. **x86 的优化与特性**
   - **Intel处理器**实现了许多特定功能，如安全性相关的**enclave**技术和专用指令集。
   - 针对特定场景，x86的某些指令的执行效率比RISC-V中的同类指令更高。
3. **市场现状与未来**
   - **目前**：全球大部分计算设备依赖x86架构。
   - **未来**：随着RISC-V的推广和更多公司支持，RISC-V可能在个人计算机领域获得更大市场份额。

## 五、关于选择处理器架构的问答

> **学生提问**：为什么我们还在使用x86，而不是使用RISC-V处理器？

- TA解答：
  1. **软件兼容性**：切换到RISC-V会导致无法运行大量已有软件。
  2. **Intel的优化**：Intel处理器内置了许多针对特定需求的高效指令。
  3. **市场成熟度**：RISC-V目前还未被广泛用于个人计算机，SiFive的RISC-V主板也是近期才推出。

## 六、总结与思考

### 1. RISC-V 与 x86 的优劣对比

- **x86的优势**：丰富的指令集和良好的向后兼容性。
- **RISC-V的优势**：简洁、开源、灵活，更容易适应未来的变化。

### 2. 市场的转变与挑战

- 尽管RISC-V在嵌入式设备中已有应用，但**在个人计算机领域的普及还需要时间**。
- **软件支持**和**兼容性**是RISC-V面临的主要挑战。

### 3. 实验中的应用

- 学生在学习和实验过程中将主要使用**RISC-V**指令集，理解精简指令集的原理及优势，为未来开发基于RISC-V的系统打下基础。

本节课通过对 **RISC-V与x86架构** 的详细对比，让学生理解了两者在设计理念和市场应用上的区别。学生将掌握**RISC-V的基础指令集**，为后续实验中的**trapframe和系统调用**编程做好准备。这些知识不仅有助于理解处理器架构的差异，也为未来在计算机系统领域的应用奠定了基础。

